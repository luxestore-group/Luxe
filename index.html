<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Luxe Store</title>
<script src="https://js.paystack.co/v1/inline.js"></script>
<style>
:root{--gold:#b8860b;--silver:#c0c0c0}
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{background:#fff8f0;color:#333;transition:.3s}
body.dark{background:#111;color:#fff}
header{background:linear-gradient(90deg,var(--gold),#fff,var(--silver));padding:14px;text-align:center;position:sticky;top:0;z-index:50}
body.dark header{background:linear-gradient(90deg,#444,#666,#999)}
h1{margin:0;font-size:1.8rem}
.header-actions{display:flex;justify-content:center;gap:10px;margin-top:8px}
.header-actions button{padding:6px 10px;border-radius:20px;border:none;font-weight:bold;cursor:pointer}

.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;padding:16px}
.card{background:#fff;border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.2);overflow:hidden;transition:.3s}
body.dark .card{background:#222}
.card img{width:100%;height:180px;object-fit:cover}
.card-body{text-align:center;padding:10px}
.price{font-weight:bold;color:var(--silver)}
.buttons{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
.buttons button{flex:1 1 45%;padding:8px;border:none;border-radius:10px;font-weight:bold;cursor:pointer}
.buy{background:var(--gold);color:#fff}
.details{background:#c0c0c0}

.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.75);align-items:center;justify-content:center;z-index:1000}
.modal.show{display:flex}
.modal-box{background:#fff;color:#000;padding:16px;border-radius:14px;max-width:560px;width:95%;max-height:90vh;overflow:auto;position:relative}
body.dark .modal-box{background:#222;color:#fff}
.close{position:absolute;right:12px;top:8px;font-size:20px;cursor:pointer}

.gallery{display:flex;gap:8px;overflow-x:auto;margin:8px 0}
.gallery img{width:150px;height:150px;object-fit:cover;border-radius:10px;cursor:zoom-in;transition:.3s}
.gallery img.zoom{transform:scale(2);cursor:zoom-out}

.cart-item{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
.cart-item button{padding:4px 8px}

.notice{font-size:.9rem;line-height:1.4}
.notice ul{padding-left:18px}
.notice li{margin-bottom:6px}

.pay{background:var(--gold);color:#fff;padding:10px;border:none;border-radius:10px;width:100%;font-weight:bold}
input, select{width:100%;padding:8px;margin:6px 0;border-radius:8px;border:1px solid #ccc}

.mtn-card img{background:#ffd700;padding:14px;object-fit:contain}

.mtn-bundles{display:grid;grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:8px;margin-top:10px}
.mtn-bundles button{padding:8px;border:none;border-radius:10px;background:var(--gold);color:#fff;cursor:pointer}
.mtn-bundles button.selected{background:#ff9900;color:#000;font-weight:bold}
</style>
</head>
<body>
<header>
<h1>Luxe Store</h1>
<div class="header-actions">
<button id="cartBtn">ðŸ›’ Cart</button>
<button id="orderBtn">ðŸ’¬ Confirm Order</button>
<button id="themeBtn">Light / Dark</button>
<button id="notifyBtn">ðŸ”” Notice</button>
</div>
</header>

<div class="products">
<!-- Blender -->
<div class="card" data-name="Silver Crest Blender 2in1 2.0L" data-price="300" data-images="images/blender.jpg,images/blenders.jpg,images/blender2.jpg">
<img src="images/blender.jpg">
<div class="card-body">
<h3>Silver Crest Blender 2-in1- 2.0L</h3>
<p class="price">â‚µ300</p>
<div class="buttons">
<button class="buy">Add to Cart</button>
<button class="details">More Details</button>
</div>
</div>
</div>

<!-- Earphones -->
<div class="card" data-name="Superbass 2-in-1 Earphones" data-price="65" data-images="images/headphones.jpg,images/headphones1.jpg">
<img src="images/headphones.jpg">
<div class="card-body">
<h3>Superbass 2-in-1 Earphones</h3>
<p class="price">â‚µ65</p>
<div class="buttons">
<button class="buy">Add to Cart</button>
<button class="details">More Details</button>
</div>
</div>
</div>

<!-- Smartwatch -->
<div class="card" data-name="Rich Ripple Smart Watch" data-price="200" data-images="images/smartwatch.jpg,images/smartwatch1.jpg">
<img src="images/smartwatch.jpg">
<div class="card-body">
<h3>Rich Ripple Smart Watch</h3>
<p class="price">â‚µ200</p>
<div class="buttons">
<button class="buy">Add to Cart</button>
<button class="details">More Details</button>
</div>
</div>
</div>

<!-- USB Cable -->
<div class="card" data-name="3-in-1 60W USB Cable" data-price="50" data-images="images/accessories.jpg,images/accessories1.jpg">
<img src="images/accessories.jpg">
<div class="card-body">
<h3>3-in-1 60W USB Cable</h3>
<p class="price">â‚µ50</p>
<div class="buttons">
<button class="buy">Add to Cart</button>
<button class="details">More Details</button>
</div>
</div>
</div>

<!-- Powerbank -->
<div class="card" data-name="Oraimo Traveler Powerbank 10000mAh" data-price="200" data-images="images/powerbank.jpg,images/powerbank1.jpg">
<img src="images/powerbank.jpg">
<div class="card-body">
<h3>Oraimo Traveler Powerbank 10000mAh</h3>
<p class="price">â‚µ200</p>
<div class="buttons">
<button class="buy">Add to Cart</button>
<button class="details">More Details</button>
</div>
</div>
</div>

<!-- MTN Data Bundle -->
<div class="card mtn-card">
<img src="images/databundles.jpg">
<div class="card-body">
<h3>MTN Data Bundles</h3>
<p class="price">â‚µ5.50 â€“ â‚µ60.00</p>
<div class="buttons">
<button class="buy" id="mtnOpenBtn">Buy Bundle</button>
<button class="details" id="mtnDetailsBtn">More Details</button>
</div>
</div>
</div>
</div>

<!-- Modals -->
<!-- Cart Modal -->
<div class="modal" id="cartModal">
<div class="modal-box">
<span class="close">Ã—</span>
<h3>Your Cart</h3>
<div id="cartItems"></div>
<p><strong>Total:</strong> â‚µ<span id="cartTotal">0</span></p>
<input id="custName" placeholder="Your name">
<input id="custPhone" placeholder="Phone number">
<input id="custEmail" placeholder="Email">
<button class="pay" id="checkoutBtn">Checkout & Pay</button>
</div>
</div>

<!-- Details Modal -->
<div class="modal" id="detailsModal">
<div class="modal-box">
<span class="close">Ã—</span>
<h3 id="detailsTitle"></h3>
<div class="gallery" id="detailsGallery"></div>
<p><strong>Delivery:</strong> 2â€“3 weeks upon purchase</p>
</div>
</div>

<!-- MTN Modal -->
<div class="modal" id="mtnModal">
<div class="modal-box">
<span class="close">Ã—</span>
<h3>MTN Data Bundles</h3>
<p>Select a bundle and enter your MTN number:</p>
<div class="mtn-bundles">
<button data-price="5.5">1GB â€“ â‚µ5.50</button>
<button data-price="12">2GB â€“ â‚µ12</button>
<button data-price="18">3GB â€“ â‚µ18</button>
<button data-price="24">4GB â€“ â‚µ24</button>
<button data-price="30">5GB â€“ â‚µ30</button>
<button data-price="36">6GB â€“ â‚µ36</button>
<button data-price="42">7GB â€“ â‚µ42</button>
<button data-price="48">8GB â€“ â‚µ48</button>
<button data-price="54">9GB â€“ â‚µ54</button>
<button data-price="60">10GB â€“ â‚µ60</button>
</div>
<input id="mtnNumber" placeholder="MTN Number (e.g. 054xxxxxxx)">
<input id="mtnName" placeholder="Your name">
<input id="mtnEmail" placeholder="Email">
<button class="pay" id="mtnPay">Pay for Bundle</button>
</div>
</div>

<!-- Notice Modal -->
<div class="modal" id="noticeModal">
<div class="modal-box">
<span class="close">Ã—</span>
<h3>Must Read Before Purchase</h3>
<div class="notice">
<ul>
<li>All products are ready for delivery.</li>
<li>Users must provide correct info before payment.</li>
<li>TURBONET / BROADBAND SIMs do not work for data bundles.</li>
<li>Wrong numbers are non-refundable.</li>
<li>Data bundle delivery: 30 mins â€“ 1 hour.</li>
</ul>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCZdOPS1D0pSW8jYjL1p7Q9JpES06Pc-UE",
  authDomain: "luxe-5a8e8.firebaseapp.com",
  projectId: "luxe-5a8e8",
  storageBucket: "luxe-5a8e8.appspot.com",
  messagingSenderId: "178257618326",
  appId: "1:178257618326:web:3c6c26f267dfcf73d3e9b7"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// THEME
document.getElementById('themeBtn').onclick = () => document.body.classList.toggle('dark');

// CART LOGIC
let cart = [];
const cartModal = document.getElementById('cartModal');
const cartItems = document.getElementById('cartItems');
const cartTotal = document.getElementById('cartTotal');

document.getElementById('cartBtn').onclick = () => cartModal.classList.add('show');
document.getElementById('notifyBtn').onclick = () => document.getElementById('noticeModal').classList.add('show');
document.querySelectorAll('.close').forEach(c => c.onclick = () => document.querySelectorAll('.modal').forEach(m=>m.classList.remove('show')));

function renderCart(){
  cartItems.innerHTML='';
  let total=0;
  cart.forEach((i,idx)=>{
    total+=i.price*i.qty;
    cartItems.innerHTML+=`<div class='cart-item'>${i.name} x${i.qty} 
      <button onclick='inc(${idx})'>+</button> 
      <button onclick='dec(${idx})'>-</button>
    </div>`;
  });
  cartTotal.textContent=total;
}
window.inc=i=>{cart[i].qty++;renderCart();}
window.dec=i=>{cart[i].qty>1?cart[i].qty--:cart.splice(i,1);renderCart();}

// Order ID generator
function generateOrderId(type="ORD"){
  const date=new Date();
  const y=date.getFullYear();
  const m=String(date.getMonth()+1).padStart(2,'0');
  const d=String(date.getDate()).padStart(2,'0');
  const rand=Math.floor(Math.random()*900+100);
  return `${type}-${y}${m}${d}-${rand}`;
}

// Add to cart & details
document.querySelectorAll('.card').forEach(card=>{
  const name=card.dataset.name;
  const price=Number(card.dataset.price||0);
  const images=(card.dataset.images||'').split(',');
  if(card.querySelector('.buy') && !card.classList.contains('mtn-card')){
    card.querySelector('.buy').onclick=()=>{cart.push({name,price,qty:1}); renderCart(); cartModal.classList.add('show');}
  }
  if(card.querySelector('.details')){
    card.querySelector('.details').onclick=()=>{
      document.getElementById('detailsTitle').textContent=name;
      const g=document.getElementById('detailsGallery'); g.innerHTML='';
      images.forEach(s=>{const im=document.createElement('img'); im.src=s; im.onclick=()=>im.classList.toggle('zoom'); g.appendChild(im);});
      document.getElementById('detailsModal').classList.add('show');
    }
  }
});

// Paystack checkout for normal products
document.getElementById('checkoutBtn').onclick=async()=>{
  if(cart.length===0){alert('Cart empty'); return;}
  const name=document.getElementById('custName').value.trim();
  const phone=document.getElementById('custPhone').value.trim();
  const email=document.getElementById('custEmail').value.trim();
  if(!name || !phone || !email){alert('Fill all info'); return;}
  const total=Number(cartTotal.textContent);
  const orderId=generateOrderId("ORD");

  const handler=PaystackPop.setup({
    key:'pk_live_98575428080557d261e91cb92fe745f878fc4278',
    email:email,
    amount:total*100,
    currency:'GHS',
    callback: async res=>{
      await addDoc(collection(db,'orders'),{
        orderId,
        customerName:name,
        customerPhone:phone,
        customerEmail:email,
        items:cart,
        totalAmount:total,
        status:'Pending',
        reference:res.reference,
        timestamp:serverTimestamp()
      });
      alert('Payment successful! Order ID: '+orderId);
      cart=[]; renderCart(); cartModal.classList.remove('show');
    },
    onClose:()=>alert('Payment cancelled')
  });
  handler.openIframe();
};

// MTN Bundles
let selectedMTNPrice=5.5;
let selectedMTNBundle="1GB";
document.querySelectorAll('.mtn-bundles button').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.mtn-bundles button').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedMTNPrice=Number(btn.dataset.price);
    selectedMTNBundle=btn.textContent.split('â€“')[0].trim();
  }
});
document.getElementById('mtnOpenBtn').onclick=()=>document.getElementById('mtnModal').classList.add('show');
document.getElementById('mtnPay').onclick=async()=>{
  const number=document.getElementById('mtnNumber').value.trim();
  const name=document.getElementById('mtnName').value.trim();
  const email=document.getElementById('mtnEmail').value.trim();
  if(!number || !name || !email){alert('Fill all info'); return;}
  const orderId=generateOrderId("MTN");
  const handler=PaystackPop.setup({
    key:'pk_live_98575428080557d261e91cb92fe745f878fc4278',
    email:email,
    amount:selectedMTNPrice*100,
    currency:'GHS',
    metadata:{custom_fields:[{display_name:'MTN Number', variable_name:'mtn_number', value:number}]},
    callback:async res=>{
      await addDoc(collection(db,'mtn_orders'),{
        orderId,
        customerName:name,
        customerPhone:number, // FIXED: store MTN number correctly
        customerEmail:email,
        bundle:selectedMTNBundle,
        amount:selectedMTNPrice,
        status:'Pending',
        reference:res.reference,
        timestamp:serverTimestamp()
      });
      alert('MTN payment successful! Order ID: '+orderId);
      document.getElementById('mtnModal').classList.remove('show');
      document.getElementById('mtnNumber').value='';
      document.getElementById('mtnName').value='';
      document.getElementById('mtnEmail').value='';
    },
    onClose:()=>alert('Payment cancelled')
  });
  handler.openIframe();
};

// WhatsApp Confirm Order (normal cart + MTN bundle)
document.getElementById('orderBtn').onclick=()=>{
  let message='Hello, I would like to confirm my order:\n';

  // Normal cart
  cart.forEach(item=>message+=`${item.name} x${item.qty} - â‚µ${item.price*item.qty}\n`);

  // MTN bundle
  const mtnNumber=document.getElementById('mtnNumber').value.trim();
  if(mtnNumber){
    message+=`MTN Bundle: ${selectedMTNBundle} - â‚µ${selectedMTNPrice}\nMTN Number: ${mtnNumber}\n`;
  }

  const total=(cart.reduce((s,i)=>s+i.price*i.qty,0))+(mtnNumber?selectedMTNPrice:0);
  message+=`Total: â‚µ${total}`;

  window.open(`https://wa.me/233548164533?text=${encodeURIComponent(message)}`,'_blank');
};
</script>
</body
